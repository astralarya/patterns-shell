# patterns-shell/templates

**patterns-shell/templates** - Code generators for shell patterns

If you wish to use a template, you should source its \*.sh file.

## deploy
### template-deploy-client
Usage: **template-deploy-client** [server] [FUNCNAME] [REMOTEFUNC]  
Output code for two functions named [FUNCNAME] (default deploy) and [FUNCNAME]-full  
to find the name of a makefile project (via make name) and  
create a tarball of the project (via make tar) and copy to [server]  
(via [server]-push) and then call [REMOTEFUNC] (default [FUNCNAME])  
or [REMOTEFUNC]-full for [FUNCNAME]-full.  
NOTE: The server should be one defined by template-remote
### template-deploy-server
Usage: **template-deploy-server** [stagedir] [livedir] [scpdir] [FUNCNAME]  
Output code for two functions named [FUNCNAME] (default deploy)  
and [FUNCNAME]-full.  
[FUNCNAME] deploys a program tarball located in [scpdir] (default ~/scp)  
to [stagedir], overwriting any previous deployment. It then builds  
and links a stable name to deployed program.  
[FUNCNAME]-full calls [FUNCNAME], then copies the deployment from  
[stagedir] to [livedir].

## pgdb
### template-db
Usage: **template-db** *name* *user* [funcname]  
Generate function to access a database as a user  
  * $1 database name
  * $2 database user
  * $3 database function name (default $1)

This template generates one function
  * **dbfuncname** [OPTION] [queryfile]  
    If a file is given as an argument, execute the queries in the file,  
    otherwise start a psql session connected to database.
    * -t time query or session
    * -h show help  

### template-dbbackup
Usage: **template-dbbackup** *name* *superuser* *backupdir* [funcname]  
Generate a function to backup a database  
  * $1 database name
  * $2 database superuser
  * $3 backup directory (absolute path, no trailing slash)
  * $4 generated function name (default ${1}backup)

This template generates one function
  * **dbbackupfunc** [OPTION] [file]  
    Backup or restore $MYDB.  
    If no arguments given, make dated backup in $3  
    otherwise, execute according the options below.  
    * -b backup database to file
    * -r restore datase from file

## remote
Generates functions to connect to a server via SSH, manage key generation and setup,
setup a SOCKS proxy using the connection, and push/pull files via SCP.

Source remote.sh in your .\*rc file, passing the following arguments.
* $1 connection name
* $2 [user@]hostname
* [$3] default remote directory for SCP push/pull; default '~/scp'

Usage: **source .../remote.sh** *name* [*user@*]*hostname* [*scpdir*]

There are four functions generated by this template
  * **[connection]** [*SSH_OPTION*] [*COMMAND*]  
    If *COMMAND* given, execute it remotely, otherwise start an SSH session
  * **[connection]-keygen**  
    Check/setup public/private key authentication for this connection
  * **[connection]-proxy**  [*PORT*]  
    Start a SOCKS proxy using this connection on localhost:*PORT* (default 9999)
  * **[connection]-push** [*-d REMOTEDIR*] [*SCP_OPTION*] *FILES...*  
    Push *FILES* to remote directory
  * **[connection]-pull** [*-d LOCALDIR*] [*SCP_OPTION*] *FILES...*  
    Pull *FILES* from remote directory

## sourcedir
### template-sourcedir
Usage: **template-sourcedir** *dir*  
Generate statements to source all files in a directory  
* $1 directory to source

